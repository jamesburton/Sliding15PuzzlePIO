# Puzzle Image Preparation - Usage Examples

## Table of Contents

1. [Basic Examples](#basic-examples)
2. [Advanced Examples](#advanced-examples)
3. [Real-World Scenarios](#real-world-scenarios)
4. [Batch Processing](#batch-processing)
5. [Integration Examples](#integration-examples)

---

## Basic Examples

### Example 1: Simple Photo Processing

**Scenario:** You have a vacation photo you want to turn into a puzzle.

```bash
python prepare_puzzle_image.py vacation.jpg
```

**What happens:**
1. Loads `vacation.jpg` (any size)
2. Detects and removes white border (if present)
3. Resizes to fill 480x480 (maintaining aspect)
4. Center crops to exactly 480x480
5. Saves to `output/vacation_480x480.png`
6. Creates preview: `output/vacation_preview.png`

**Output:**
```
Processing: vacation.jpg
  Original size: 4032x3024
  Detected borders: top=50px, bottom=50px, left=50px, right=50px
  After border removal: 3932x2924
  Resizing and cropping to 480x480...
  ✓ Saved: output/vacation_480x480.png
  Generating 4x4 tile preview...
  ✓ Saved: output/vacation_preview.png

PROCESSING COMPLETE
Final image size: 480x480
Tile size: 120x120
Grid: 4x4 = 16 tiles (15 + empty)
```

---

### Example 2: Custom Output Name

**Scenario:** You want a specific name for your puzzle.

```bash
python prepare_puzzle_image.py landscape.jpg mountain_sunrise
```

**Output:**
- `output/mountain_sunrise_480x480.png`
- `output/mountain_sunrise_preview.png`

**Use case:** When you have multiple images and need organized names.

---

### Example 3: Easy Puzzle (3x3)

**Scenario:** Creating a puzzle for kids or beginners.

```bash
python prepare_puzzle_image.py cute_cat.jpg --tiles 3
```

**Result:**
- 3x3 grid = 8 tiles + 1 empty
- Each tile: 160x160 pixels (larger, easier to see)
- Good for: Kids, beginners, simple images

---

### Example 4: Expert Puzzle (6x6)

**Scenario:** Creating a challenging puzzle.

```bash
python prepare_puzzle_image.py complex_cityscape.jpg --tiles 6
```

**Result:**
- 6x6 grid = 35 tiles + 1 empty
- Each tile: 80x80 pixels (smaller, more challenging)
- Good for: Experts, detailed images, high difficulty

---

## Advanced Examples

### Example 5: Sensitive Border Detection

**Scenario:** Image has subtle gradient borders that aren't detected.

```bash
# Default (threshold=10) misses the border
python prepare_puzzle_image.py photo.jpg

# Increase sensitivity
python prepare_puzzle_image.py photo.jpg --threshold 5
```

**When to use:**
- Photos with matte finish
- Scanned images with slight edge coloring
- Gradient backgrounds

---

### Example 6: Ignore Border Detection

**Scenario:** Tool incorrectly removes part of the image.

```bash
# Make detection very insensitive
python prepare_puzzle_image.py photo.jpg --threshold 50

# Or edit the image first to remove actual borders
```

---

### Example 7: Generate C Header for Embedding

**Scenario:** You want to embed the image in firmware.

```bash
python prepare_puzzle_image.py logo.png company_logo --header
```

**Output:**
- `output/company_logo_480x480.png`
- `output/company_logo_preview.png`
- `output/company_logo.h` ← **C header file**

**Content of .h file:**
```cpp
#pragma once

// Image: 480x480, Format: RGB565
// Generated by prepare_puzzle_image.py

const uint16_t company_logo[230400] PROGMEM = {
    0xF800, 0xF800, 0xF800, 0x07E0, 0x07E0, ...
};

const int company_logo_width = 480;
const int company_logo_height = 480;
```

**Use in code:**
```cpp
#include "company_logo.h"

void displayLogo() {
    for (int i = 0; i < 230400; i++) {
        uint16_t color = pgm_read_word(&company_logo[i]);
        int x = i % 480;
        int y = i / 480;
        tft.drawPixel(x, y, color);
    }
}
```

---

### Example 8: RGB888 Format

**Scenario:** You need full 24-bit color (not recommended for ESP32 due to size).

```bash
python prepare_puzzle_image.py photo.jpg --header --format rgb888
```

**Size comparison:**
- RGB565: ~450 KB
- RGB888: ~675 KB

---

### Example 9: Skip Preview

**Scenario:** Processing many images and don't need previews.

```bash
python prepare_puzzle_image.py photo.jpg --no-preview
```

**Saves time** when batch processing.

---

## Real-World Scenarios

### Scenario 1: Family Photo Album Puzzles

You have 20 family photos and want to create puzzles from each.

**Windows:**
```batch
for %%f in (family_photos\*.jpg) do (
    python prepare_puzzle_image.py "%%f"
)
```

**Linux/Mac:**
```bash
for img in family_photos/*.jpg; do
    python prepare_puzzle_image.py "$img"
done
```

**Result:**
- 20 processed puzzles in `output/` folder
- Each with preview
- Ready to copy to ESP32 SD card

---

### Scenario 2: Museum Artwork Collection

You're creating an educational puzzle game with famous paintings.

```bash
# Name each puzzle appropriately
python prepare_puzzle_image.py starry_night.jpg vangogh_starry --tiles 5
python prepare_puzzle_image.py mona_lisa.jpg davinci_mona --tiles 5
python prepare_puzzle_image.py scream.jpg munch_scream --tiles 5
```

**Why tiles=5?**
- More challenging (24 tiles)
- Artwork has details that benefit from more tiles
- Still playable without being frustrating

---

### Scenario 3: Company Logo Splash Screen

You want your company logo to appear as an easy puzzle on device startup.

```bash
python prepare_puzzle_image.py company_logo.png logo --tiles 3 --header
```

**Benefits:**
- 3x3 = Easy to solve quickly
- Header file = Embedded in firmware (no SD card needed)
- Professional presentation

---

### Scenario 4: Travel Photos with Frames

You have professional travel photos with decorative frames.

```bash
# Photos have 80px white borders
python prepare_puzzle_image.py paris.jpg eiffel_tower --threshold 10
python prepare_puzzle_image.py tokyo.jpg tokyo_tower --threshold 10
python prepare_puzzle_image.py nyc.jpg statue_liberty --threshold 10
```

**Result:**
- Borders automatically removed
- Focus on actual content
- Clean 480x480 puzzles

---

### Scenario 5: Wildlife Photography

High-resolution wildlife photos with varying compositions.

```bash
# High-res images, standard difficulty
python prepare_puzzle_image.py eagle_4k.jpg eagle_portrait --tiles 4
python prepare_puzzle_image.py tiger_6k.jpg tiger_close --tiles 4
python prepare_puzzle_image.py dolphin_8k.jpg dolphin_leap --tiles 4
```

**Why 4x4?**
- Good balance of difficulty
- Wildlife photos have clear subjects that work well
- 15 tiles is engaging without being overwhelming

---

## Batch Processing

### Windows Batch Script

Create `process_all.bat`:

```batch
@echo off
echo Processing all images in current folder...

for %%f in (*.jpg *.png) do (
    echo Processing: %%f
    python prepare_puzzle_image.py "%%f"
)

echo.
echo All images processed!
echo Check the output folder.
pause
```

---

### PowerShell Script

Create `Process-Images.ps1`:

```powershell
# Process all images in a folder with custom settings

param(
    [string]$Path = ".",
    [int]$Tiles = 4,
    [int]$Threshold = 10
)

Get-ChildItem -Path $Path -Include *.jpg,*.png -Recurse | ForEach-Object {
    Write-Host "Processing: $($_.Name)" -ForegroundColor Green

    python prepare_puzzle_image.py `
        $_.FullName `
        --tiles $Tiles `
        --threshold $Threshold
}

Write-Host "`nProcessing complete!" -ForegroundColor Cyan
```

**Usage:**
```powershell
# Process current folder
.\Process-Images.ps1

# Process specific folder
.\Process-Images.ps1 -Path "C:\Photos" -Tiles 5

# Different difficulty
.\Process-Images.ps1 -Tiles 3
```

---

### Linux/Mac Bash Script

Create `process_all.sh`:

```bash
#!/bin/bash

# Process all images in directory
# Usage: ./process_all.sh [directory] [tiles]

DIR="${1:-.}"
TILES="${2:-4}"

echo "Processing images in: $DIR"
echo "Grid size: ${TILES}x${TILES}"
echo

for img in "$DIR"/*.{jpg,jpeg,png,JPG,JPEG,PNG}; do
    if [ -f "$img" ]; then
        echo "Processing: $(basename "$img")"
        python3 prepare_puzzle_image.py "$img" --tiles "$TILES"
    fi
done

echo
echo "All images processed!"
echo "Check the output/ folder"
```

**Make executable:**
```bash
chmod +x process_all.sh
```

**Usage:**
```bash
# Process current directory
./process_all.sh

# Process specific directory
./process_all.sh ~/Pictures/Vacation

# Different grid size
./process_all.sh ~/Pictures/Vacation 5
```

---

## Integration Examples

### Example: ESP32 Game with Multiple Puzzles

**1. Prepare images:**

```bash
python prepare_puzzle_image.py puzzle1.jpg beach
python prepare_puzzle_image.py puzzle2.jpg mountain
python prepare_puzzle_image.py puzzle3.jpg city
```

**2. Copy to SD card:**

```
SD_CARD/
├── puzzles/
│   ├── beach_480x480.png
│   ├── mountain_480x480.png
│   └── city_480x480.png
└── previews/
    ├── beach_preview.png
    ├── mountain_preview.png
    └── city_preview.png
```

**3. ESP32 code to load:**

```cpp
#include <SD.h>

const char* puzzles[] = {
    "/puzzles/beach_480x480.png",
    "/puzzles/mountain_480x480.png",
    "/puzzles/city_480x480.png"
};

int currentPuzzle = 0;

void loadPuzzle(int index) {
    if (!SD.begin()) {
        Serial.println("SD Card failed!");
        return;
    }

    File file = SD.open(puzzles[index], FILE_READ);
    if (!file) {
        Serial.println("Failed to open puzzle!");
        return;
    }

    // Draw full image first
    tft.drawPngFile(file, 0, 0);

    // Split into sprites
    for (int i = 0; i < 15; i++) {
        tiles[i].createSprite(120, 120);
        int x = (i % 4) * 120;
        int y = (i / 4) * 120;
        tiles[i].readRect(x, y, 120, 120, &tiles[i]);
    }

    file.close();
}

void setup() {
    loadPuzzle(0);  // Load first puzzle
}

void nextPuzzle() {
    currentPuzzle = (currentPuzzle + 1) % 3;
    loadPuzzle(currentPuzzle);
}
```

---

### Example: Menu with Preview Images

**1. Prepare with previews:**

```bash
python prepare_puzzle_image.py easy.jpg easy_puzzle --tiles 3
python prepare_puzzle_image.py medium.jpg medium_puzzle --tiles 4
python prepare_puzzle_image.py hard.jpg hard_puzzle --tiles 5
```

**2. Show previews in menu:**

```cpp
void showPuzzleMenu() {
    tft.fillScreen(TFT_BLACK);

    // Load and display previews as thumbnails
    const char* previews[] = {
        "/previews/easy_puzzle_preview.png",
        "/previews/medium_puzzle_preview.png",
        "/previews/hard_puzzle_preview.png"
    };

    for (int i = 0; i < 3; i++) {
        File f = SD.open(previews[i]);
        // Draw scaled-down preview (e.g., 150x150)
        tft.drawPngFile(f, i * 160, 100, 150, 150);
        f.close();
    }

    tft.setTextSize(2);
    tft.drawString("EASY",   80, 270);
    tft.drawString("MEDIUM", 240, 270);
    tft.drawString("HARD",   400, 270);
}
```

---

### Example: Progress System

Track which puzzles are completed:

```cpp
struct PuzzleRecord {
    char filename[32];
    bool completed;
    int bestTime;
    int bestMoves;
};

PuzzleRecord puzzles[] = {
    {"/puzzles/beach_480x480.png", false, 999, 999},
    {"/puzzles/mountain_480x480.png", false, 999, 999},
    {"/puzzles/city_480x480.png", false, 999, 999}
};

void markPuzzleComplete(int index, int time, int moves) {
    puzzles[index].completed = true;
    if (time < puzzles[index].bestTime) {
        puzzles[index].bestTime = time;
    }
    if (moves < puzzles[index].bestMoves) {
        puzzles[index].bestMoves = moves;
    }
    // Save to EEPROM or preferences
}
```

---

## Tips & Tricks

### Tip 1: Test with Generated Images

Before processing your real photos, test with generated patterns:

```bash
# Create test images
python create_test_images.py

# Process them
python prepare_puzzle_image.py test_images/pattern_with_border.png
```

This verifies the tool works correctly.

---

### Tip 2: Preview Before Committing

Always check the preview image before copying to ESP32:

1. Process image
2. Open `output/*_preview.png`
3. Verify tiles look good
4. Check if image is recognizable when split

If tiles are too similar → choose different image or change grid size.

---

### Tip 3: Organize by Difficulty

```bash
python prepare_puzzle_image.py easy1.jpg easy_1 --tiles 3
python prepare_puzzle_image.py easy2.jpg easy_2 --tiles 3
python prepare_puzzle_image.py medium1.jpg medium_1 --tiles 4
python prepare_puzzle_image.py medium2.jpg medium_2 --tiles 4
python prepare_puzzle_image.py hard1.jpg hard_1 --tiles 5
python prepare_puzzle_image.py hard2.jpg hard_2 --tiles 5
```

Prefix makes it easy to load by difficulty level.

---

### Tip 4: Pre-Edit Images for Best Results

Before processing:
- Crop to interesting area
- Adjust brightness/contrast
- Enhance colors if needed
- Remove unwanted elements

Then process with the tool for optimal results.

---

### Tip 5: Memory Management

For devices with limited PSRAM:

**Option 1:** Use 3x3 grid (requires less memory)
```bash
python prepare_puzzle_image.py photo.jpg --tiles 3
```

**Option 2:** Don't load all tiles at once
```cpp
// Instead of loading all 15 tiles
// Load only visible tiles dynamically
```

---

## Summary of Common Commands

| Use Case | Command |
|----------|---------|
| Basic processing | `python prepare_puzzle_image.py photo.jpg` |
| Easy puzzle | `python prepare_puzzle_image.py photo.jpg --tiles 3` |
| Hard puzzle | `python prepare_puzzle_image.py photo.jpg --tiles 5` |
| Custom name | `python prepare_puzzle_image.py photo.jpg my_puzzle` |
| Embed in firmware | `python prepare_puzzle_image.py photo.jpg --header` |
| Sensitive borders | `python prepare_puzzle_image.py photo.jpg --threshold 5` |
| Batch process | `for %%f in (*.jpg) do python prepare_puzzle_image.py "%%f"` |
| No preview | `python prepare_puzzle_image.py photo.jpg --no-preview` |

---

**Next Steps:**
1. Install dependencies: `pip install -r requirements.txt`
2. Test with sample: `python create_test_images.py`
3. Process your images
4. Copy to ESP32
5. Enjoy your puzzles!
